---
title: 【 JS 】编程风格
date: 2017-02-07 22:31:31
tags: JavaScript
---

# 基本的格式化

## 缩进层级

使用制表符进行缩进，或者使用空格符进行缩进，**推荐使用4个空格符为一个缩进层级**，很多文本编辑器都默认缩进设置为 4 个空格，可以在文本编辑器中配置敲击 Tab 键时插入几个空格。

## 语句结尾
js 的语句要么独占一行，要么以分号结尾，有腊鱼分析器的自动分号插入机制，js 代码省略分号也是可以正常工作的，但是 **推荐不要省略分号**，以避免 ASI 在错误的位置插入分号，同时这样做在某些情况下可以增进代码的性能。

## 行的长度
js 风格指南中很少提及行的长度，但 **推荐每行代码长度不超过 80 个字符**。

## 换行
当一行长度达到了单行最大字符数限制时，就需要手动将一行拆成两行。**推荐在运算符后换行，并且在下一行增加两个层级的缩进**；当给变量赋值时，应当保持所有赋值运算符的位置对齐。

## 空行
推荐插入空行的位置：在方法之间、在方法的局部变量和第一条语句之间、在多行或单行注释之前、在方法内的逻辑片段之间插入空行，提高可读性。

## 命名
推荐采用 **小驼峰命名法** 命名，引申：匈牙利命名法（特点是在名称之前冠以类型标识符前缀，但当前主流的编程规范都不推荐这种命名法）。

### 变量和函数
推荐 **变量名以名词为前缀，函数名以动词为前缀**。

### 常量
推荐 **使用大写字符和下划线来命名**，下划线用以分隔单词。

### 构造函数
推荐使用 **大驼峰命名法（Pascal Case）**

## 直接量
### 字符串
推荐 **使用双引号**，这样有益于在上下文之间切换。

### 数字
推荐 **不要在代码中使用八进制直接量**，如：var num = 010;

### null
- **应该使用的场景**
	- 用来初始化一个可能赋值为一个对象的变量；
	- 用来和一个已经初始化的变量比较，这个变量可以是也可以不是一个对象；
	- 当函数的参数期望是对象时，作为参数传入；
	- 当函数的返回值期望是对象时，用作返回值传出；
- **不应该使用的场景**
	- 不要用 null 来检测是否传入了某个参数；
	- 不要用 null 来检测一个未初始化的变量；

### undefined
null == undefined 结果是 true，那些没有被初始化的变量都有一个初始值，即 undefined，表示这个变量等待被赋值。推荐避免在代码中使用 undefined。

### 对象直接量
**推荐在创建对象时使用对象直接量，在直接量中直接写出所有属性**。
```
// 不推荐的写法
var book = new Object();
book.title = "JS";
book.author = "WC";

// 推荐的写法
var book = {
	title : "JS",
	author : "WC" 
};
```

### 数组直接量
**推荐使用数组直接量来定义数组，不赞成显式地使用 Array 构造函数来创建数组**

<br>

# 注释
## 单行注释
注意：单行注释不应当以连续多行注释的形式出现，除非你注释掉一大段代码。

## 多行注释
```
// 推荐的写法

/*
 * 注释至少包含三行
 * 多行注释之前应当有一个空行，且缩进层级和其描述的代码保持一致
 */
```

## 使用注释
**应该使用注释的场景**
- 难于理解的代码
- 可能被误认为错误的代码
- 浏览器特性 hack

## 文档注释
**推荐使用 JavaDoc 文档格式**：多行注释以单斜线加双星号（/**）开始，接下来是描述信息，其中使用 @ 符号来表示一个或多个属性。推荐使用文档生成工具来为 JS 文件生成文档。

<br>

# 语句和表达式
所有的块语句都应当使用花括号，包括：if、for、while、do...while...、try...catch...finally

## 花括号的对齐方式
**推荐将左花括号放置在块语句中第一句代码的末尾**。

## 块语句间隔
**推荐在左圆括号之前和右圆括号之后各添加一个空格****
```
// 推荐的写法
if (condition) {
	doSomething();
}
```

## switch 语句
js 中的 switch 语句的行为和其他语言的不同之处：switch 语句中可以使用任意类型值，任何表达式都可以合法地用于 case 从句。但在其他语言中必须使用原始值和常量。

### 缩进
**推荐的写法**：
- 每条 case 语句相对于 switch 关键字都缩进一个层级；
- 从第二条 case 语句开始，每条 case 语句前后各有一个空行；
```
// 推荐的写法
switch(condition) {
	case "first":
		// 代码
		break;

	case "second":
		// 代码
		// break;

	default:
		// 代码
}
```

### case 语句的 “连续执行”
**推荐可以使用连续执行，但是要添加注释**

### default
**推荐在没有默认行为并且添加了注释的情况下可以省略 default**。

## with 语句
with 语句可以更改包含的上下文解析变量的方式，通过 with 可以用局部变量和函数的形式来访问特定对象的属性和方法，这样就可以将对象前缀统统省略掉。
```
var book = {
	title : "js",
	author: "wc"
}

var messgae = "The book is ";

with (book) {
	message += title;  // 用局部变量的形式来访问特定对象的属性
	message += " by " + author;
}
```
在严格模式中，with 语句是被明确禁止的，如果使用会报语法错误。**推荐避免使用 with 语句**。

## for 循环
for 循环有两种：一种是传统的 for 循环，往往用于遍历数组成员；另一种是 for-in 循环，用来遍历对象的属性。Crockford 的编程规范不允许使用 continue，主张用条件语句代替 continue。**推荐尽可能避免使用  continue，当然可以根据代码的可读性来决定是否使用**。

## for-in 循环
for-in 循环用来遍历对象属性，不用定义任何控制条件，循环将会有条不紊地遍历每个对象属性，并返回属性名而不是值。for-in 循环有一个问题，就是它不仅遍历对象的实例属性，同样还遍历从原型继承来的属性。最好使用 `hasOwnProperty()` 方法来为 for-in 循环过滤出实力属性。**推荐总是在 for-in 循环之前使用 hasOwnProperty()，除非你想查找原型链**。

<br>

# 变量、函数和运算符
## 变量声明
不论 var 语句是否真正会被执行，所有的 var 语句都 **提前到包含这段逻辑的函数的顶部执行（函数作用域）**。
```
function doSomething() {
	var result = 10 + value;  
	var value = 10;
	return result;   // NaN
}

// 解析过程
function doSomething() {
	var result; 
	var value;

	result = 10 + value;
	value = 10; 

	return result;
}
```
变量声明提前意味着在函数内部任意位置定义变量和在函数顶部定义变量是完全一样的。因此，**推荐总是将局部变量的定义作为函数内的第一条语句**，并且将所有的 var 语句合并为一个语句，每个变量的初始化独占一行，赋值运算符对齐，没有初始值的变量出现在 var 语句的尾部。

## 函数声明
**推荐先声明函数再使用**，函数内部的局部函数应该紧接着变量声明之后声明，函数声明应该在语句块之外。

## 函数调用间隔
推荐在函数名和左括号之间没有空格，这样做是为了将其与块语句区分开来。

## 立即调用的函数
**推荐使用圆括号包含立即执行的函数**。
```
// 推荐的写法
var value = (function() {

	// 函数体

	return true;

}());
```

## 严格模式
使用 `use strict;` 指令使脚本以严格模式执行，这条编译指令不仅用于全局，也适用于局部，比如一个函数内。**推荐最好不要在全局作用域中使用严格模式，并且尽可能使用严格模式以减少常见错误的发生**。

## 相等
- == 和 != (会强制类型转换)
	- 比较数字和字符串，会将字符串转换为数字，然后比较；
	- 比较数字和布尔值，会将布尔值转换为数字，然后比较；
	- 比较对象和非对象吗，先调用对象的 valueOf() 方法，没有则调用 toString()，再比较；
- === 和 ！==
	- 不会涉及强制类型转换，如果两个值的类型不一样，则认为它们不相等；
** 推荐总是使用 === 和 !==**

### eval()
在 js 中，eval() 的参数是一个字符串，eval() 会将传入的字符串当做代码来执行。开发者可以通过这个函数来载入外部的 js 代码，或者随机生成 js 代码并执行它。在 js 中，eval() 并不是唯一可以执行 js 字符串的函数，使用 Function 构造函数 和 setTimeout()、setInterval() 也可以。但是，**推荐不要使用 Function，setTimeout() 和 setInterval() 使用函数而不是字符串，eval() 建议只在解析 JSON 数据别无他法时使用**。

### 原始包装类型
js 中有 3 种原始包装类型：String、Boolean 和 Number。原始包装类型的作用是让原始值具有对象的行为。
```
var name = "Jack";
name.author = true;
console.log(name.author);  // undefined
```
author属性不见了，是因为表示这个字符串的临时 String 对象在第 2 行执行结束后就销毁了，第 3 行又创建了一个新 String 对象。**推荐不要使用原始包装类型**。